# Zira Banking System

## Описание

Zira — современный REST API для банковского сервиса на Go, реализованный по принципам Clean Architecture, SOLID, DRY, YAGNI. Проект покрывает все требования к безопасности, масштабируемости и тестируемости. Поддерживает регистрацию, аутентификацию, работу со счетами, картами, переводами, кредитами, аналитикой, интеграции с внешними сервисами (ЦБ РФ, SMTP).

---

## Как пользоваться сервисом

1. **Клонируйте репозиторий:**
   ```sh
   git clone <repo-url>
   cd Zira
   ```
2. **Настройте конфигурацию:**
   - Отредактируйте `config/config.yaml` (пример файла есть в репозитории).
3. **Примените миграции для создания таблиц:**
   ```sh
   psql -U <user> -d <db> -f migrations/001_init.sql
   ```
4. **Установите зависимости:**
   ```sh
   go mod tidy
   ```
5. **Запустите сервер:**
   ```sh
   go run cmd/api/main.go
   ```
6. **API будет доступен на http://localhost:8080

---

## Поддерживаемые команды (эндпоинты)

- **POST**   `/register` — регистрация пользователя
- **POST**   `/login` — аутентификация
- **GET**    `/profile` — профиль пользователя
- **POST**   `/accounts` — создать счет
- **GET**    `/accounts` — список счетов
- **GET**    `/accounts/{accountId}` — детали счета
- **POST**   `/transfer` — перевод между счетами
- **POST**   `/cards` — выпуск карты
- **GET**    `/cards` — список карт
- **GET**    `/cards/{cardId}` — детали карты
- **POST**   `/credits` — оформить кредит
- **GET**    `/credits` — список кредитов
- **GET**    `/credits/{creditId}` — детали кредита
- **GET**    `/credits/{creditId}/schedule` — график платежей
- **GET**    `/analytics` — аналитика
- **GET**    `/accounts/{accountId}/predict` — прогноз баланса

---

## Как протестировать код

В проекте реализованы unit-тесты для бизнес-логики (слой сервисов), покрывающие основные сценарии работы с пользователями, счетами, кредитами и др. Используются моки для изоляции зависимостей.

**Запуск всех тестов:**
```sh
# Запустить все тесты во всех пакетах
go test ./...
```

**Пример запуска тестов только для сервисов:**
```sh
cd internal/services
# Запустить тесты только для сервисов
go test -v
```

**Что покрыто тестами:**
- Регистрация и валидация пользователя
- Оформление кредита, расчет аннуитетного платежа
- Обработка просроченных платежей (шедулер)
- Проверка бизнес-правил и ошибок

---

## Архитектура и структура проекта

- `cmd/api/main.go` — точка входа, настройка зависимостей
- `internal/models` — модели данных (User, Account, Card, Credit, PaymentSchedule и др.)
- `internal/repository` — репозитории (доступ к БД, CRUD)
- `internal/services` — бизнес-логика, интеграции (email, SOAP, аналитика)
- `internal/handlers` — HTTP-обработчики
- `internal/routes` — маршрутизация
- `internal/middleware` — middleware (JWT, логирование, безопасность)
- `migrations` — миграции БД (создание всех таблиц)
- `config` — конфиги (yaml)

**Ключевые принципы:**
- Чистая архитектура (разделение слоев, слабые зависимости)
- SOLID, DRY, YAGNI
- Безопасность: bcrypt, PGP, HMAC, JWT, валидация, права доступа
- Легко расширяемый и тестируемый код

---

## Безопасность
- Пароли и CVV хранятся в виде хеша (bcrypt)
- Данные карт шифруются (PGP), используется HMAC
- JWT для аутентификации и авторизации
- Проверка прав доступа к счетам и операциям

---

## Интеграции
- SMTP для email-уведомлений (gomail)
- SOAP к ЦБ РФ для получения ключевой ставки (beevik/etree)

---

## Контакты
- Автор: Ivan Kovalenko
